<body>
  <div class="container mt-5 position-relative pt-5">
    <!-- כפתור חזור -->
    <button class="back-button" onclick="window.history.back()">חזור</button>

    <h2 class="mb-3">מסלול הגעה</h2>

    <h5 class="text-muted">נקודת מוצא:</h5>
    <p class="fw-bold">{{ route_addresses[0] }}</p>

    <h5 class="text-muted mt-4">תחנות במסלול:</h5>
    <ol class="list-group list-group-numbered mb-4">
      {% for address in route_addresses[1:-1] %}
        <li class="list-group-item">{{ address }}</li>
      {% endfor %}
      {% if route_addresses|length > 1 %}
        <li class="list-group-item destination">
          יעד סופי: {{ route_addresses[-1] }}
        </li>
      {% endif %}
    </ol>

    <div id="map"></div>
  </div>

  <!-- שאר הסקריפטים שלך נשארים זהים -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o9N1j7f48iWjOGeNp+2DpP7ZTlj6ASn7PkpGz0hF0xo="
    crossorigin=""
  ></script>
  <script>
    const coords = {{ coordinates | tojson }};
    const addresses = {{ route_addresses | tojson }};

    if (coords.length === 0) {
      alert('לא נמצאו נקודות למפה');
    } else {
      var map = L.map('map').setView(coords[0], 13);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '© OpenStreetMap'
      }).addTo(map);

      coords.forEach(function(coord, index) {
        let markerIcon;
        let popupText;

        if (index === 0) {
          markerIcon = L.divIcon({
            className: 'start-marker',
            html: '<div>&#9733;</div>'
          });
          popupText = `נקודת מוצא:<br>${addresses[index]}`;
        } else if (index === coords.length - 1) {
          markerIcon = L.divIcon({
            className: 'destination-marker',
            html: `<div>${index}</div>`
          });
          popupText = `יעד סופי:<br>${addresses[index]}`;
        } else {
          markerIcon = L.divIcon({
            className: 'number-marker',
            html: `<div>${index}</div>`
          });
          popupText = `תחנה ${index}:<br>${addresses[index]}`;
        }

        L.marker(coord, { icon: markerIcon }).addTo(map)
          .bindPopup(popupText);
      });

      var polyline = L.polyline(coords, { color: 'blue' }).addTo(map);
      map.fitBounds(polyline.getBounds());
    }
  </script>
</body>
